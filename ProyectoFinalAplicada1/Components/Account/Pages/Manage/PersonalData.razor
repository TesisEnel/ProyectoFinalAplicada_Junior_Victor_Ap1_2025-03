@page "/Account/Manage/PersonalData"

@using Microsoft.AspNetCore.Identity
@using ProyectoFinalAplicada1.Data

@inject UserManager<ApplicationUser> UserManager
@inject IdentityRedirectManager RedirectManager

<PageTitle>Datos Personales</PageTitle>

<div class="d-flex align-items-center justify-content-center min-vh-100" style="margin-top: -60px;">

    <div class="col-md-10 col-lg-7 col-xl-6" style="margin-right: 15rem;">

        <StatusMessage />

        <div class="card card-neo p-4 border-0 text-center">

            <i class="bi bi-archive-fill mb-3" style="font-size: 3rem; color: #3D5D35;"></i>
            <h3 class="fw-bold mb-3" style="color: #3D5D35;">DATOS PERSONALES</h3>

            <p class="text-muted mb-4 px-4">Tu cuenta contiene datos personales que nos has proporcionado. Esta página te permite descargarlos o eliminarlos permanentemente.</p>

            <div class="d-grid gap-3 col-md-10 mx-auto">
                <form action="Account/Manage/DownloadPersonalData" method="post">
                    <AntiforgeryToken />
                    <button class="profile_button w-100" type="submit">
                        <i class="bi bi-download me-2"></i> DESCARGAR DATOS
                    </button>
                </form>

                <a href="Account/Manage/DeletePersonalData" class="profile_button text-decoration-none" style="color: #C15349;">
                    <i class="bi bi-trash-fill me-2"></i> BORRAR CUENTA
                </a>
            </div>

        </div>
    </div>
</div>

@code {
    [CascadingParameter]
    private HttpContext HttpContext { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        var user = await UserManager.GetUserAsync(HttpContext.User);
        if (user is null)
        {
            RedirectManager.RedirectToInvalidUser(UserManager, HttpContext);
        }
    }
}